<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>线段树练习（也有树状数组） | Taduro の blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="线段树练习（也有树状数组）洛谷 P2184 贪婪大陆题目背景 面对蚂蚁们的疯狂进攻，小FF的Tower defence宣告失败……人类被蚂蚁们逼到了Greed  Island上的一个海湾。现在，小FF的后方是一望无际的大海， 前方是变异了的超级蚂蚁。 小FF还有大好前程，他可不想命丧于此，  于是他派遣手下最后一批改造SCV布置地雷以阻挡蚂蚁们的进攻。 题目描述 小FF最后一道防线是一条长度为N的">
<meta name="keywords" content="学习笔记,树状数组,线段树">
<meta property="og:type" content="article">
<meta property="og:title" content="线段树练习（也有树状数组）">
<meta property="og:url" content="http://dftyem.github.io/2018/12/11/线段树练习（也有树状数组）/index.html">
<meta property="og:site_name" content="Taduro の blog">
<meta property="og:description" content="线段树练习（也有树状数组）洛谷 P2184 贪婪大陆题目背景 面对蚂蚁们的疯狂进攻，小FF的Tower defence宣告失败……人类被蚂蚁们逼到了Greed  Island上的一个海湾。现在，小FF的后方是一望无际的大海， 前方是变异了的超级蚂蚁。 小FF还有大好前程，他可不想命丧于此，  于是他派遣手下最后一批改造SCV布置地雷以阻挡蚂蚁们的进攻。 题目描述 小FF最后一道防线是一条长度为N的">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://i.loli.net/2018/12/11/5c0f4b2606c66.png">
<meta property="og:image" content="https://i.loli.net/2018/12/11/5c0f4ba5359ea.gif">
<meta property="og:updated_time" content="2018-12-11T10:19:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="线段树练习（也有树状数组）">
<meta name="twitter:description" content="线段树练习（也有树状数组）洛谷 P2184 贪婪大陆题目背景 面对蚂蚁们的疯狂进攻，小FF的Tower defence宣告失败……人类被蚂蚁们逼到了Greed  Island上的一个海湾。现在，小FF的后方是一望无际的大海， 前方是变异了的超级蚂蚁。 小FF还有大好前程，他可不想命丧于此，  于是他派遣手下最后一批改造SCV布置地雷以阻挡蚂蚁们的进攻。 题目描述 小FF最后一道防线是一条长度为N的">
<meta name="twitter:image" content="https://i.loli.net/2018/12/11/5c0f4b2606c66.png">
  
    <link rel="alternative" href="/atom.xml" title="Taduro の blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet">
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/head.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/" title="Hi Mate">Taduro</a></h1>
        </hgroup>

        
        <p class="header-subtitle">十年饮冰，难凉热血。</p>
        
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">博客首页</a></li>
                        
                            <li><a href="/更新日志">更新日志</a></li>
                        
                            <li><a href="/about">留言打卡</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="https://account.microsoft.com/profile/" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/dftyem" title="github">github</a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/生涯回忆/" style="font-size: 10px;">-生涯回忆</a> <a href="/tags/01trie/" style="font-size: 10px;">01trie</a> <a href="/tags/2-SAT/" style="font-size: 10px;">2-SAT</a> <a href="/tags/AC自动机/" style="font-size: 10px;">AC自动机</a> <a href="/tags/DP/" style="font-size: 16.67px;">DP</a> <a href="/tags/POI/" style="font-size: 10px;">POI</a> <a href="/tags/luogu/" style="font-size: 13.33px;">luogu</a> <a href="/tags/主席树/" style="font-size: 10px;">主席树</a> <a href="/tags/分块/" style="font-size: 10px;">分块</a> <a href="/tags/前缀和/" style="font-size: 13.33px;">前缀和</a> <a href="/tags/单调队列/" style="font-size: 10px;">单调队列</a> <a href="/tags/博弈论/" style="font-size: 10px;">博弈论</a> <a href="/tags/学习笔记/" style="font-size: 20px;">学习笔记</a> <a href="/tags/差分/" style="font-size: 10px;">差分</a> <a href="/tags/平衡树/" style="font-size: 10px;">平衡树</a> <a href="/tags/思维/" style="font-size: 10px;">思维</a> <a href="/tags/栈/" style="font-size: 10px;">栈</a> <a href="/tags/树状数组/" style="font-size: 13.33px;">树状数组</a> <a href="/tags/树链剖分/" style="font-size: 10px;">树链剖分</a> <a href="/tags/概率与期望/" style="font-size: 10px;">概率与期望</a> <a href="/tags/生成树/" style="font-size: 10px;">生成树</a> <a href="/tags/离散化/" style="font-size: 10px;">离散化</a> <a href="/tags/线段树/" style="font-size: 16.67px;">线段树</a> <a href="/tags/网络流/" style="font-size: 13.33px;">网络流</a> <a href="/tags/莫队/" style="font-size: 16.67px;">莫队</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://stevebraveman.github.io/">Steve_braveman</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://hachimanjy.github.io/">Hackjy</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://challestend.github.io/">Rehtorbegnaro</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://blog.csdn.net/feifanbaijun/article/category/7969117">feifanbaijun</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.cnblogs.com/shzr/">慎老师</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.cnblogs.com/asuldb">一辈子也打不过的wzx</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">来自SD slyz彩笔OIer,常用ID：多弗桃,Taduro,bronze</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">Taduro</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">Taduro</a></h1>
            </hgroup>
            
            <p class="header-subtitle">十年饮冰，难凉热血。</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">博客首页</a></li>
                
                    <li><a href="/更新日志">更新日志</a></li>
                
                    <li><a href="/about">留言打卡</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="https://account.microsoft.com/profile/" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/dftyem" title="github">github</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-线段树练习（也有树状数组）" class="article article-type-post" itemscope="" itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/12/11/线段树练习（也有树状数组）/" class="article-date">
      <time datetime="2018-12-11T04:40:04.000Z" itemprop="datePublished">2018-12-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      线段树练习（也有树状数组）
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/学习笔记/">学习笔记</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/树状数组/">树状数组</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/线段树/">线段树</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="线段树练习（也有树状数组）"><a href="#线段树练习（也有树状数组）" class="headerlink" title="线段树练习（也有树状数组）"></a>线段树练习（也有树状数组）</h2><h3 id="洛谷-P2184-贪婪大陆"><a href="#洛谷-P2184-贪婪大陆" class="headerlink" title="洛谷 P2184 贪婪大陆"></a><strong>洛谷 P2184 贪婪大陆</strong></h3><p><strong>题目背景</strong></p>
<p>面对蚂蚁们的疯狂进攻，小FF的Tower defence宣告失败……人类被蚂蚁们逼到了Greed  Island上的一个海湾。现在，小FF的后方是一望无际的大海， 前方是变异了的超级蚂蚁。 小FF还有大好前程，他可不想命丧于此，  于是他派遣手下最后一批改造SCV布置地雷以阻挡蚂蚁们的进攻。</p>
<p><strong>题目描述</strong></p>
<p>小FF最后一道防线是一条长度为N的战壕， 小FF拥有无数多种地雷，而SCV每次可以在[ L , R  ]区间埋放同一种不同于之前已经埋放的地雷。 由于情况已经十万火急，小FF在某些时候可能会询问你在[ L’ , R’] 区间内有多少种不同的地雷，  他希望你能尽快的给予答复。</p>
<a id="more"></a>
<p>对于30%的数据： 0&lt;=n, m&lt;=1000;</p>
<p>对于100%的数据： 0&lt;=n, m&lt;=10^5.</p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong></p>
<p>第一行为两个整数n和m； n表示防线长度， m表示SCV布雷次数及小FF询问的次数总和。</p>
<p>接下来有m行， 每行三个整数Q，L , R； 若Q=1 则表示SCV在[ L , R ]这段区间布上一种地雷， 若Q=2则表示小FF询问当前[ L , R ]区间总共有多少种地雷。</p>
<p> <strong>输出格式：</strong></p>
<p>对于小FF的每次询问，输出一个答案（单独一行），表示当前区间地雷总数。</p>
<p>思路：这题第一眼看完全没有思路啊，但其实很简单，我们可以把一个区间看成开头和结尾两个点，那么假如我们能知道一个点前面有多少开头和结尾（显然能），这题会不会好做呢？</p>
<p>看图</p>
<p><img src="https://i.loli.net/2018/12/11/5c0f4b2606c66.png" alt="img"></p>
<p>就把这个玩意当图吧（别笑！！！），左箭头表示一个区间的开头，右箭头表示结尾，两个|之间是我们要查询的区间，首先我们先不管区间的结尾，那么有可能的答案个数就是查询区间结尾前面的区间开头个数。</p>
<p>这样我们做出来差点AC的0分做法，因为有些区间早在查询区间开头前就结束了，这些区间的个数？查询区间开头前面有一个右箭头就结束一个区间你还问什么！</p>
<p>那么ans=sum1[r]-sum2[l-1]（l,r表示查询区间的开始和结束，是l-1的原因是如果在l处有一个区间结束了，那也要算到答案里）</p>
<p>树状数组做的（这一定是假的线段树练习）：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> c1[<span class="number">100001</span>],c2[<span class="number">100001</span>],n,t; </span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">return</span> x&amp;(-x);&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update1</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x&lt;=n)&#123;</span><br><span class="line">        c1[x]++;</span><br><span class="line">        x+=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update2</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x&lt;=n)&#123;</span><br><span class="line">        c2[x]++;</span><br><span class="line">        x+=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query1</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x)&#123;</span><br><span class="line">        ans+=c1[x];</span><br><span class="line">        x-=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query2</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x)&#123;</span><br><span class="line">        ans+=c2[x];</span><br><span class="line">        x-=lowbit(x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> b,x,y;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;t);</span><br><span class="line">    <span class="keyword">while</span> (t--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;b,&amp;x,&amp;y);</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">1</span>)&#123;</span><br><span class="line">            update1(x);</span><br><span class="line">            update2(y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">int</span> c=query1(y)-query2(x<span class="number">-1</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="洛谷-P3870-TJOI2009-开关-P2846-USACO08NOV-光开关Light-Switching-P2574-XOR的艺术（三道重题）"><a href="#洛谷-P3870-TJOI2009-开关-P2846-USACO08NOV-光开关Light-Switching-P2574-XOR的艺术（三道重题）" class="headerlink" title="洛谷 P3870 [TJOI2009]开关+P2846 [USACO08NOV]光开关Light Switching+P2574 XOR的艺术（三道重题）"></a><strong>洛谷 P3870 [TJOI2009]开关+P2846 [USACO08NOV]光开关Light Switching+P2574 XOR的艺术（三道重题）</strong></h3><p><strong>题目描述</strong></p>
<p>现有N（2 ≤ N ≤ 100000）盏灯排成一排，从左到右依次编号为：1，2，……，N。然后依次执行M（1 ≤ M ≤  100000）项操作，操作分为两种：第一种操作指定一个区间[a,  b]，然后改变编号在这个区间内的灯的状态（把开着的灯关上，关着的灯打开），第二种操作是指定一个区间[a,  b]，要求你输出这个区间内有多少盏灯是打开的。灯在初始时都是关着的。</p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong></p>
<p>第一行有两个整数N和M，分别表示灯的数目和操作的数目。接下来有M行，每行有三个整数，依次为：c, a,  b。其中c表示操作的种类，当c的值为0时，表示是第一种操作。当c的值为1时表示是第二种操作。a和b则分别表示了操作区间的左右边界（1 ≤ a ≤  b ≤ N）。</p>
<p> <strong>输出格式：</strong></p>
<p>每当遇到第二种操作时，输出一行，包含一个整数：此时在查询的区间中打开的灯的数目。</p>
<p>这么水的题还三道？我第一个做的是那个XOR的艺术，那题还需要建个树，其他两个，emmmm。</p>
<p>其实就是让你把一变成零，把零变成一，那么下推的法则就是sum[rt]=r-l+1-sum[rt]，然后标记取异或，算了看代码吧。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">ll sum[<span class="number">4000001</span>],ad[<span class="number">4000001</span>],n,t,i,a[<span class="number">1000001</span>];</span><br><span class="line"><span class="keyword">char</span> c;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(ll rt)</span></span>&#123;sum[rt]=sum[rt&lt;&lt;<span class="number">1</span>]+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(ll rt,ll l,ll r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        sum[rt]=a[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ll m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>,l,m);</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(ll rt,ll l,ll r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ad[rt])&#123;</span><br><span class="line">        ll m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>]^=ad[rt];</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]^=ad[rt];</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>]=(m-l+<span class="number">1</span>)-sum[rt&lt;&lt;<span class="number">1</span>];</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]=(r-m)-sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">        ad[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(ll rt,ll l,ll r,ll x,ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x&gt;r||l&gt;y) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">        sum[rt]=r-l+<span class="number">1</span>-sum[rt];</span><br><span class="line">        ad[rt]=ad[rt]^<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    ll m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) update(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> ll <span class="title">query</span><span class="params">(ll rt,ll l,ll r,ll x,ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x&gt;r||l&gt;y) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)    <span class="keyword">return</span> sum[rt];</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    ll ans=<span class="number">0</span>,m=(r+l)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) ans+=query(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) ans+=query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll b,x,y;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lld%lld"</span>,&amp;n,&amp;t);</span><br><span class="line">    c=getchar(); c=getchar();</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%c"</span>,&amp;c);</span><br><span class="line">        a[i]=c-<span class="string">'0'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">while</span> (t--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld"</span>,&amp;b,&amp;x,&amp;y);</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">0</span>)&#123;</span><br><span class="line">            update(<span class="number">1</span>,<span class="number">1</span>,n,x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,query(<span class="number">1</span>,<span class="number">1</span>,n,x,y));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="洛谷-P1471-方差"><a href="#洛谷-P1471-方差" class="headerlink" title="洛谷 P1471 方差"></a><strong>洛谷 P1471 方差</strong></h3><p><strong>题目背景</strong></p>
<p>滚粗了的HansBug在收拾旧数学书，然而他发现了什么奇妙的东西。</p>
<p><strong>题目描述</strong></p>
<p>蒟蒻HansBug在一本数学书里面发现了一个神奇的数列，包含N个实数。他想算算这个数列的平均数和方差。</p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong></p>
<p>第一行包含两个正整数N、M，分别表示数列中实数的个数和操作的个数。</p>
<p>第二行包含N个实数，其中第i个实数表示数列的第i项。</p>
<p>接下来M行，每行为一条操作，格式为以下两种之一：</p>
<p>操作1：1 x y k ，表示将第x到第y项每项加上k，k为一实数。</p>
<p>操作2：2 x y ，表示求出第x到第y项这一子数列的平均数。</p>
<p>操作3：3 x y ，表示求出第x到第y项这一子数列的方差。</p>
<p> <strong>输出格式：</strong></p>
<p>输出包含若干行，每行为一个实数，即依次为每一次操作2或操作3所得的结果（所有结果四舍五入保留4位小数）。</p>
<p>思路：</p>
<p>首先，平均数好求，维护一个区间和就好了，那么我们来推柿子：</p>
<p>设数列 a1,a2,a3…an长度为n(废话)，平均数为x</p>
<p>那么方差：$((a1-x)^2 + (a2-x)^2 +(a3-x)^2…….+ (an-x)^2 )/n$</p>
<p> $=(a1^2 + a2^2 …… +an^2 +n<em>x^2 - 2</em>(a1+a2..an)*x)/n;$</p>
<p>那么我们设$a1+a2..+an=sum$</p>
<p>则$n<em>x=sum n</em>x<em>x=sum</em>x$</p>
<p>则原式=$(a1^2 + a2^2 …… +an^2 +sum<em>x - 2</em>sum*x)/n$</p>
<p>=$(a1^2 + a2^2 …… +an^2  - sum*x)/n;$</p>
<p>又 $sum/n=x$</p>
<p>则原式=$(a1^2 + a2^2 …… +an^2 )/n- x^2;$</p>
<p>这么看我们只要求平方和和平均数就好了？</p>
<p>还没完，还有区间加呢！怎么维护一个区间的平方和呢？</p>
<p>接着推柿子：</p>
<p>还是设数列 $a1,a2,a3…an$长度为n,这个数列要加x</p>
<p>那么$(a1+x)^2+(a2+x)^2+(a3+x)^2+…..(a2+x)^2$</p>
<p>=$a1^2 + a2^2…… +an^2 +n<em>x^2 +2</em>(a1+a2..+an)*x$</p>
<p>于是我们就可以同时维护和以及平方和，然后用上面那个式子求方差。</p>
<p>完了。。这回真完了。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> d double </span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">d a[<span class="number">100001</span>],sum[<span class="number">400001</span>],sf[<span class="number">400001</span>],ad[<span class="number">400001</span>];</span><br><span class="line"><span class="keyword">int</span> n,t,i;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;</span><br><span class="line">    sum[rt]=sum[rt&lt;&lt;<span class="number">1</span>]+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    sf[rt]=sf[rt&lt;&lt;<span class="number">1</span>]+sf[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        sum[rt]=a[l];</span><br><span class="line">        sf[rt]=a[l]*a[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>,l,m);</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ad[rt])&#123;</span><br><span class="line">        <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>]+=ad[rt];</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=ad[rt];</span><br><span class="line">        sf[rt&lt;&lt;<span class="number">1</span>]+=(ad[rt]*ad[rt]*(m-l+<span class="number">1</span>)+sum[rt&lt;&lt;<span class="number">1</span>]*ad[rt]*<span class="number">2</span>);</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>]+=ad[rt]*(m-l+<span class="number">1</span>);</span><br><span class="line">        sf[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=(ad[rt]*ad[rt]*(r-m)+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]*ad[rt]*<span class="number">2</span>);</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=ad[rt]*(r-m);</span><br><span class="line">        ad[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y,d k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||r&lt;x) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">        ad[rt]+=k;</span><br><span class="line">        sf[rt]+=k*k*(r-l+<span class="number">1</span>)+sum[rt]*k*<span class="number">2</span>;</span><br><span class="line">        sum[rt]+=k*(r-l+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    update(rt&lt;&lt;<span class="number">1</span>,l,m,x,y,k);</span><br><span class="line">    update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y,k);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> d <span class="title">query1</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||r&lt;x) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)    <span class="keyword">return</span> sum[rt];</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;d ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) ans+=query1(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) ans+=query1(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> d <span class="title">query2</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||r&lt;x) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)    <span class="keyword">return</span> sf[rt];</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;d ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) ans+=query2(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) ans+=query2(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> ans;    </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y,b; d k;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;t);</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n; i++) <span class="built_in">cin</span>&gt;&gt;a[i];</span><br><span class="line">    build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">while</span> (t--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>,&amp;b,&amp;x,&amp;y);</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%lf"</span>,&amp;k);</span><br><span class="line">            update(<span class="number">1</span>,<span class="number">1</span>,n,x,y,k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">2</span>)&#123;</span><br><span class="line">            d f=query1(<span class="number">1</span>,<span class="number">1</span>,n,x,y)/(y-x+<span class="number">1</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%.4lf\n"</span>,f);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">3</span>)&#123;</span><br><span class="line">            d ret=query2(<span class="number">1</span>,<span class="number">1</span>,n,x,y)/(y-x+<span class="number">1</span>),pj=query1(<span class="number">1</span>,<span class="number">1</span>,n,x,y)/(y-x+<span class="number">1</span>);</span><br><span class="line">            d fg=ret-pj*pj;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%.4lf\n"</span>,fg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="洛谷-P1438-无聊的数列"><a href="#洛谷-P1438-无聊的数列" class="headerlink" title="洛谷 P1438 无聊的数列"></a><strong>洛谷 P1438 无聊的数列</strong></h3><p><strong>题目背景</strong></p>
<p>无聊的YYB总喜欢搞出一些正常人无法搞出的东西。有一天，无聊的YYB想出了一道无聊的题：无聊的数列。。。（K峰：这题不是傻X题吗）</p>
<p><strong>题目描述</strong></p>
<p>维护一个数列{a[i]}，支持两种操作：</p>
<p>1、1 L R K D：给出一个长度等于R-L+1的等差数列，首项为K，公差为D，并将它对应加到a[L]~a[R]的每一个数上。即：令a[L]=a[L]+K，a[L+1]=a[L+1]+K+D，</p>
<p>a[L+2]=a[L+2]+K+2D……a[R]=a[R]+K+(R-L)D。</p>
<p>2、2 P：询问序列的第P个数的值a[P]。 </p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong></p>
<p>第一行两个整数数n，m，表示数列长度和操作个数。</p>
<p>第二行n个整数，第i个数表示a[i]（i=1,2,3…,n）。</p>
<p>接下来的m行，表示m个操作，有两种形式：</p>
<p>1 L R K D</p>
<p>2 P 字母意义见描述（L≤R）。</p>
<p> <strong>输出格式：</strong></p>
<p>对于每个询问，输出答案，每个答案占一行。</p>
<p><img src="https://i.loli.net/2018/12/11/5c0f4ba5359ea.gif" alt="img"></p>
<p>第一眼看：嗯？等差数列？单点查询？</p>
<p>并没有思路，然后翻题解翻到了差分，没了。</p>
<p>我们可以先这么想，毒瘤出题人怎么可能只有单点查询呢！说单点查询一定是坑人的！最后一定还是区间查询！</p>
<p>区间查询出一个点的值？差分！（以上是笑话）</p>
<p>思路：既然知道了用差分，那么我们来看怎么维护，分类讨论一下，首先看首项，它的差分数组应该加k，后面l+1到r项应该全部加d，第r+1项要减去等比数列的最后一项（全部是根据差分的定义，请自行模拟）。</p>
<p>那么单点查询就是求差分数组的前缀和。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> sum[<span class="number">400001</span>],n,t,a[<span class="number">100001</span>],ad[<span class="number">400001</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;sum[rt]=sum[rt&lt;&lt;<span class="number">1</span>]+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        sum[rt]=a[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>,l,m);</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ad[rt])&#123;</span><br><span class="line">        <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>]+=ad[rt]*(m-l+<span class="number">1</span>);</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=ad[rt]*(r-m);</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>]+=ad[rt];</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=ad[rt];</span><br><span class="line">        ad[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||r&lt;x) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">        ad[rt]+=k;</span><br><span class="line">        sum[rt]+=(r-l+<span class="number">1</span>)*k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) update(rt&lt;&lt;<span class="number">1</span>,l,m,x,y,k);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y,k);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||x&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y) <span class="keyword">return</span> sum[rt];</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>,ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=m) ans+=query(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) ans+=query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y=<span class="number">0</span>,b,k,d,i;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>,&amp;n,&amp;t);</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">        a[i]=x-y;</span><br><span class="line">        y=x;</span><br><span class="line">    &#125;</span><br><span class="line">    build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">while</span> (t--)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;b);</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>,&amp;x,&amp;y,&amp;k,&amp;d);</span><br><span class="line">            update(<span class="number">1</span>,<span class="number">1</span>,n,x,x,k);</span><br><span class="line">            <span class="keyword">if</span> (x&lt;y) update(<span class="number">1</span>,<span class="number">1</span>,n,x+<span class="number">1</span>,y,d);</span><br><span class="line">            <span class="keyword">if</span> (y&lt;n) update(<span class="number">1</span>,<span class="number">1</span>,n,y+<span class="number">1</span>,y+<span class="number">1</span>,-(k+(y-x)*d));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d\n"</span>,query(<span class="number">1</span>,<span class="number">1</span>,n,<span class="number">1</span>,x));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="洛谷-P1558-色板游戏"><a href="#洛谷-P1558-色板游戏" class="headerlink" title="洛谷 P1558 色板游戏"></a><strong>洛谷 P1558 色板游戏</strong></h3><p><strong>题目背景</strong></p>
<p>阿宝上学了，今天老师拿来了一块很长的涂色板。</p>
<p><strong>题目描述</strong></p>
<p>色板长度为L，L是一个正整数，所以我们可以均匀地将它划分成L块1厘米长的小方格。并从左到右标记为1, 2, … L。</p>
<p>现在色板上只有一个颜色，老师告诉阿宝在色板上只能做两件事：</p>
<ol>
<li>“C A B C” 指在A到 B 号方格中涂上颜色 C。</li>
<li>“P A B” 指老师的提问：A到 B号方格中有几种颜色。</li>
</ol>
<p>学校的颜料盒中一共有 T 种颜料。为简便起见，我们把他们标记为 1, 2, … T. 开始时色板上原有的颜色就为1号色。 面对如此复杂的问题，阿宝向你求助，你能帮助他吗？</p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong></p>
<p>第一行有3个整数 L (1 &lt;= L &lt;= 100000), T (1 &lt;= T &lt;= 30) 和 O (1 &lt;= O &lt;= 100000)。 在这里O表示事件数。<br>接下来 O 行, 每行以 “C A B C” 或 “P A B” 得形式表示所要做的事情(这里 A, B, C 为整数, 可能A&gt; B，这样的话需要你交换A和B)</p>
<p> <strong>输出格式：</strong></p>
<p>对于老师的提问，做出相应的回答。每行一个整数。</p>
<p>看着看着就睡着了，醒了以后发现这题这么水，人在困的时候会变傻？</p>
<p>这题看上去好吓人啊，但第二眼看就可以发现t&lt;=30，那么我们就可以状态压缩一下，如果一个数二进制的第i位为1，则这个数代表的区间里有第i个颜色的格子。<br>状压完毕。<br>之后我们再来看怎么套到线段树上，无非就是确定上推和下推规则，先看上推，我们可以直接按位于一下（因为只要求左右区间一个有这种颜色），再来下推，由于颜色可以覆盖，那么直接把原来的值给覆盖掉，lazy标记也是如此。<br>上代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">ll sum[<span class="number">400001</span>],n,t,c,i,ad[<span class="number">400001</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(ll rt)</span></span>&#123;</span><br><span class="line">    sum[rt]=sum[rt&lt;&lt;<span class="number">1</span>]|sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">build</span><span class="params">(ll rt,ll l,ll r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        sum[rt]=<span class="number">1</span>&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>,l,m);</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(ll rt,ll l,ll r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ad[rt])&#123;</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>]=(<span class="number">1</span>&lt;&lt;ad[rt]);</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]=(<span class="number">1</span>&lt;&lt;ad[rt]);</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>]=ad[rt];</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]=ad[rt];</span><br><span class="line">        ad[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(ll rt,ll l,ll r,ll x,ll y,ll k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||x&gt;r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">        sum[rt]=(<span class="number">1</span>&lt;&lt;k);</span><br><span class="line">        ad[rt]=k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    ll m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) update(rt&lt;&lt;<span class="number">1</span>,l,m,x,y,k);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y,k);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(ll rt,ll l,ll r,ll x,ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||x&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)    <span class="keyword">return</span> sum[rt];</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    ll m=(l+r)&gt;&gt;<span class="number">1</span>,ans=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) ans|=query(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) ans|=query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> u; ll x,y,k;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld"</span>,&amp;n,&amp;c,&amp;t);</span><br><span class="line">    build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">while</span> (t--)&#123;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;u;</span><br><span class="line">        <span class="keyword">if</span>(u==<span class="string">'C'</span>)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld"</span>,&amp;x,&amp;y,&amp;k);</span><br><span class="line">            <span class="keyword">if</span> (x&gt;y) swap(x,y);</span><br><span class="line">            update(<span class="number">1</span>,<span class="number">1</span>,n,x,y,k);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">"%lld%lld"</span>,&amp;x,&amp;y);</span><br><span class="line">            <span class="keyword">if</span> (x&gt;y) swap(x,y);</span><br><span class="line">            ll p=query(<span class="number">1</span>,<span class="number">1</span>,n,x,y),ans=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=c; i++) <span class="keyword">if</span> (p&amp;(<span class="number">1</span>&lt;&lt;i)) ans++;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="洛谷-P1637-三元上升子序列"><a href="#洛谷-P1637-三元上升子序列" class="headerlink" title="洛谷 P1637 三元上升子序列"></a><strong>洛谷 P1637 三元上升子序列</strong></h3><p><strong>题目描述</strong></p>
<p>Erwin最近对一种叫”thair”的东西巨感兴趣。。。</p>
<p>在含有n个整数的序列a1,a2……an中，</p>
<p>三个数被称作”thair”当且仅当i&lt;j&lt;k且ai&lt;aj&lt;ak</p>
<p>求一个序列中”thair”的个数。</p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong></p>
<p>开始一个正整数n,</p>
<p>以后n个数a1~an。</p>
<p> <strong>输出格式：</strong></p>
<p>“thair”的个数</p>
<p>首先，n2的做法显而易见，枚举三元组中间那个点，在它两边找比他小和大的数的个数乘起来（这个暴力有60！），我们可以发现，这个东西就是逆序对。</p>
<p>然后我们可以用线段树或树状数组维护一个桶，以求一个数x前面比它小的数为例，就是在1到x之间求和，然后再把x加入桶里。</p>
<p>由于数据范围比较大，我们需要离散化，一定有数字相同，所以我们要去重（蜜汁押韵）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    ll rank,z;</span><br><span class="line">&#125;a[<span class="number">30001</span>];</span><br><span class="line">ll b[<span class="number">30001</span>],n,i,o[<span class="number">200001</span>],ans,c[<span class="number">30001</span>],j;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(node c,node d)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c.z&lt;d.z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(ll rt)</span></span>&#123;</span><br><span class="line">    o[rt]=o[rt&lt;&lt;<span class="number">1</span>]+o[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(ll rt,ll l,ll r,ll x)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;x||r&lt;x) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (l==x&amp;&amp;r==x)&#123;</span><br><span class="line">        o[rt]++;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ll m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=m) update(rt&lt;&lt;<span class="number">1</span>,l,m,x);</span><br><span class="line">    <span class="keyword">if</span> (x&gt;m) update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(ll rt,ll l,ll r,ll x,ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||x&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)    <span class="keyword">return</span> o[rt];</span><br><span class="line">    ll m=(r+l)&gt;&gt;<span class="number">1</span>,ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=m) ret+=query(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) ret+=query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;n);</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;a[i].z);</span><br><span class="line">        a[i].rank=i;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(a+<span class="number">1</span>,a+n+<span class="number">1</span>,cmp);</span><br><span class="line">    j=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        b[a[i].rank]=j;</span><br><span class="line">        <span class="keyword">if</span> (a[i].z!=a[i+<span class="number">1</span>].z) j++;</span><br><span class="line">    &#125;</span><br><span class="line">    j--;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;=n<span class="number">-1</span>; i++)&#123;</span><br><span class="line">        update(<span class="number">1</span>,<span class="number">1</span>,n,b[i]);</span><br><span class="line">        <span class="keyword">if</span> (b[i]==<span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">        c[i]=query(<span class="number">1</span>,<span class="number">1</span>,n,<span class="number">1</span>,b[i]<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">memset</span>(o,<span class="number">0</span>,<span class="keyword">sizeof</span>(o));</span><br><span class="line">    <span class="keyword">for</span> (i=n; i&gt;=<span class="number">2</span>; i--)&#123;</span><br><span class="line">        update(<span class="number">1</span>,<span class="number">1</span>,n,b[i]);</span><br><span class="line">        <span class="keyword">if</span> (b[i]==j) <span class="keyword">continue</span>;</span><br><span class="line">        ans+=c[i]*query(<span class="number">1</span>,<span class="number">1</span>,n,b[i]+<span class="number">1</span>,n);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="洛谷-P4145-上帝造题的七分钟2-花神游历各国"><a href="#洛谷-P4145-上帝造题的七分钟2-花神游历各国" class="headerlink" title="洛谷 P4145 上帝造题的七分钟2 / 花神游历各国"></a><strong>洛谷 P4145 上帝造题的七分钟2 / 花神游历各国</strong></h3><p><strong>题目描述</strong> </p>
<p>“第一分钟，X说，要有数列，于是便给定了一个正整数数列。</p>
<p>第二分钟，L说，要能修改，于是便有了对一段数中每个数都开平方(下取整)的操作。</p>
<p>第三分钟，k说，要能查询，于是便有了求一段数的和的操作。</p>
<p>第四分钟，彩虹喵说，要是noip难度，于是便有了数据范围。</p>
<p>第五分钟，诗人说，要有韵律，于是便有了时间限制和内存限制。 </p>
<p>第六分钟，和雪说，要省点事，于是便有了保证运算过程中及最终结果均不超过64位有符号整数类型的表示范围的限制。</p>
<p>第七分钟，这道题终于造完了，然而，造题的神牛们再也不想写这道题的程序了。” </p>
<p>——《上帝造题的七分钟·第二部》</p>
<p>所以这个神圣的任务就交给你了。 </p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong> </p>
<p>第一行一个整数 n ，代表数列中数的个数。</p>
<p>第二行 n 个正整数，表示初始状态下数列中的数。 </p>
<p>第三行一个整数 m ，表示有 m 次操作。 </p>
<p>接下来 m 行每行三个整数<code>k,l,r</code>，</p>
<ul>
<li><code>k=0</code>表示给 [l,r] 中的每个数开平方(下取整)</li>
<li><code>k=1</code>表示询问 [l,r] 中各个数的和。</li>
</ul>
<p>数据中有可能 l&gt;r ，所以遇到这种情况请交换l和r。</p>
<p> <strong>输出格式：</strong> </p>
<p>对于询问操作，每行输出一个回答。</p>
<p><strong>说明</strong></p>
<p>对于30%的数据，1≤n,m≤1000 ，数列中的数不超过 32767 。</p>
<p>对于100%的数据，1≤n,m≤100000 ，1≤l,r≤n ，数列中的数大于0 ，且不超过 10^12 。</p>
<p>注意l有可能大于r，遇到这种情况请交换l,r。</p>
<p>区间开平方？？？这个。。我这个蒟蒻只能想到暴力了。</p>
<p>那我们就考虑优化这个暴力好了，我们发现这个开平方只要求向下取整，那么开到最小也只会变成一，于是如果一个区间内只有一我们就不开了。</p>
<p>怎么判断一个区间是不是只有一呢？由于都是正整数，我们可以考虑最大值，主要是可以和区间和一起维护，而且由于我们是暴力修改，也不用下推。</p>
<p>那么我们就可以用线段树切了这道题。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="keyword">char</span> ss[<span class="number">1</span>&lt;&lt;<span class="number">17</span>],*A=ss,*B=ss;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span>&#123;<span class="keyword">if</span>(A==B)&#123;B=(A=ss)+fread(ss,<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">17</span>,<span class="built_in">stdin</span>);<span class="keyword">if</span>(A==B)<span class="keyword">return</span> EOF;&#125;<span class="keyword">return</span>*A++;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>(<span class="title">T</span>&amp;<span class="title">x</span>)&#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> c;<span class="keyword">static</span> <span class="keyword">int</span> y;</span><br><span class="line">    <span class="keyword">for</span>(c=gc(),x=<span class="number">0</span>,y=<span class="number">1</span>;c&lt;<span class="number">48</span>||<span class="number">57</span>&lt;c;c=gc())<span class="keyword">if</span>(c==<span class="string">'-'</span>)y=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;<span class="number">48</span>&lt;=c&amp;&amp;c&lt;=<span class="number">57</span>;c=gc())x=((x+(x&lt;&lt;<span class="number">2</span>))&lt;&lt;<span class="number">1</span>)+(c^<span class="string">'0'</span>);</span><br><span class="line">    x*=y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(ll&amp;x)</span></span>&#123;<span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;x);&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">ll n,a[<span class="number">100001</span>],t,sum[<span class="number">400001</span>],maxn[<span class="number">400001</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(ll rt)</span></span>&#123;</span><br><span class="line">    sum[rt]=sum[rt&lt;&lt;<span class="number">1</span>]+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    maxn[rt]=max(maxn[rt&lt;&lt;<span class="number">1</span>],maxn[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(ll rt,ll l,ll r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        sum[rt]=a[l];</span><br><span class="line">        maxn[rt]=a[l];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ll m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>,l,m);</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(ll rt,ll l,ll r,ll x,ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x&gt;r||l&gt;y) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        sum[rt]=<span class="built_in">sqrt</span>(sum[rt]);</span><br><span class="line">        maxn[rt]=<span class="built_in">sqrt</span>(maxn[rt]);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ll m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(maxn[rt&lt;&lt;<span class="number">1</span>]&gt;<span class="number">1</span>&amp;&amp;m&gt;=x) update(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (maxn[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]&gt;<span class="number">1</span>&amp;&amp;m&lt;y) update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(ll rt,ll l,ll r,ll x,ll y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||x&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y) <span class="keyword">return</span> sum[rt];</span><br><span class="line">    ll m=(l+r)&gt;&gt;<span class="number">1</span>,ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) ret+=query(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) ret+=query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll b,x,y;</span><br><span class="line">    read(n);</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++) read(a[i]);</span><br><span class="line">    read(t);</span><br><span class="line">    build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">while</span> (t--)&#123;</span><br><span class="line">        read(b); read(x); read(y);</span><br><span class="line">        <span class="keyword">if</span> (x&gt;y) swap(x,y);</span><br><span class="line">        <span class="keyword">if</span> (!b)</span><br><span class="line">            update(<span class="number">1</span>,<span class="number">1</span>,n,x,y);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>,query(<span class="number">1</span>,<span class="number">1</span>,n,x,y));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="洛谷-P4344-SHOI2015-脑洞治疗仪"><a href="#洛谷-P4344-SHOI2015-脑洞治疗仪" class="headerlink" title="洛谷 P4344 [SHOI2015]脑洞治疗仪"></a><strong>洛谷 P4344 [SHOI2015]脑洞治疗仪</strong></h3><p><strong>题目描述</strong></p>
<p>曾经发明了自动刷题机的发明家 SHTSC 又公开了他的新发明：脑洞治疗仪——一种可以治疗他因为发明而日益增大的脑洞的神秘装置。</p>
<p>为了简单起见，我们将大脑视作一个 01 序列。 1 代表这个位置的脑组织正常工作， 0 代表这是一块脑洞。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>      <span class="number">0</span>      <span class="number">1</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">1</span>      <span class="number">1</span>      <span class="number">1</span>      <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>脑洞治疗仪修补某一块脑洞的基本工作原理就是将另一块连续区域挖出，将其中正常工作的脑组织填补在这块脑洞中。（所以脑洞治疗仪是脑洞的治疗仪？）</p>
<p>例如，用上面第 8 号位置到第 10 号位置去修补第 1 号位置到第 4 号位置的脑洞，我们就会得到：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>      <span class="number">1</span>      <span class="number">1</span>      <span class="number">1</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">1</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>如果再用第 1 号位置到第 4 号位置去修补第 8 号位置到第 10 号位置：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">1</span>      <span class="number">1</span>      <span class="number">1</span>      <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>这是因为脑洞治疗仪会把多余出来的脑组织直接扔掉。</p>
<p>如果再用第 7 号位置到第 10 号位置去填补第 1 号位置到第 6 号位置：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>      <span class="number">1</span>      <span class="number">1</span>      <span class="number">1</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>这是因为如果新脑洞挖出来的脑组织不够多，脑洞治疗仪仅会尽量填补位置比较靠前的脑洞。</p>
<p>假定初始时 SHTSC 并没有脑洞，给出一些挖脑洞和脑洞治疗的操作序列，你需要即时回答 SHTSC 的问题：在大脑某个区间中最大的连续脑洞区域有多大。</p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong></p>
<p>第一行两个整数 n 、m，表示 SHTSC 的大脑可分为从 1 到 n 编号的 n 个连续区域，有 m 个操作。</p>
<p>以下 m 行每行是下列三种格式之一：</p>
<ul>
<li>0 l r ：SHTSC 挖了一个范围为 [l,r] 的脑洞。</li>
<li>1 l_0 r_0 l_1 r_1 ：SHTSC 进行了一次脑洞治疗，用从 l_0 到 r_0 的脑组织修补 l_1 到 r_1 的脑洞。</li>
<li>2 l r ：SHTSC 询问 [l,r] 区间内最大的脑洞有多大。</li>
</ul>
<p>上述区间均在 [1,n] 范围内。</p>
<p> <strong>输出格式：</strong> </p>
<p>对于每个询问，输出一行一个整数，表示询问区间内最大连续脑洞区域有多大。</p>
<p>调了将近一个下午终于A了这道题，似乎没有我想的那么难？？？</p>
<p>肯定是要用线段树的，那我们来看怎么实现。</p>
<p>0操作：区间修改，把板子写上改一下，完。。</p>
<p>1操作：首先模拟题意，把l0到r0的脑细胞取出来（区间求和+区间修改），然后在l1到r1区间找出几个连续的0把脑细胞补上</p>
<p>怎么找0呢？首先暴力肯定是不行的，由于连续最长的0满足单调性，我们可以二分查找。</p>
<p>而这个二分还有一个前提就是当前序列的起点得是0，不然怎么也找不到。</p>
<p>那怎么办呢？由于起点不是零就是一，我们可以先二分找以起点开头连续最长的1序列，然后把它的终点后面一个元素（一定是0）作为0序列的起点，这样就找到一个以当前起点连续最长的0，然后把它补上（区间修改成一）。</p>
<p>这是如果还能补，我们就又面临当时的那个问题，循环一下就好了。</p>
<p>2操作：我们会了一操作，这个自然也会了。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="keyword">char</span> ss[<span class="number">1</span>&lt;&lt;<span class="number">17</span>],*A=ss,*B=ss;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span>&#123;<span class="keyword">if</span>(A==B)&#123;B=(A=ss)+fread(ss,<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">17</span>,<span class="built_in">stdin</span>);<span class="keyword">if</span>(A==B)<span class="keyword">return</span> EOF;&#125;<span class="keyword">return</span>*A++;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>(<span class="title">T</span>&amp;<span class="title">x</span>)&#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> c;<span class="keyword">static</span> <span class="keyword">int</span> y;</span><br><span class="line">    <span class="keyword">for</span>(c=gc(),x=<span class="number">0</span>,y=<span class="number">1</span>;c&lt;<span class="number">48</span>||<span class="number">57</span>&lt;c;c=gc())<span class="keyword">if</span>(c==<span class="string">'-'</span>)y=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;<span class="number">48</span>&lt;=c&amp;&amp;c&lt;=<span class="number">57</span>;c=gc())x=((x+(x&lt;&lt;<span class="number">2</span>))&lt;&lt;<span class="number">1</span>)+(c^<span class="string">'0'</span>);</span><br><span class="line">    x*=y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;x)</span></span>&#123;<span class="built_in">scanf</span>(<span class="string">"%d"</span>,&amp;x);&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> ad[<span class="number">800001</span>],sum[<span class="number">800001</span>],n,t;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;<span class="keyword">if</span>(x&gt;<span class="number">9</span>) write(x/<span class="number">10</span>);<span class="built_in">putchar</span>(x%<span class="number">10</span>^<span class="number">48</span>);&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> rt)</span></span>&#123;</span><br><span class="line">    sum[rt]=sum[rt&lt;&lt;<span class="number">1</span>]+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l==r)&#123;</span><br><span class="line">        sum[rt]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>,l,m);</span><br><span class="line">    build(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ad[rt])&#123;</span><br><span class="line">        <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        ad[rt]--;</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>]=ad[rt]*(m-l+<span class="number">1</span>);</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]=ad[rt]*(r-m);</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>]=ad[rt]+<span class="number">1</span>;</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]=ad[rt]+<span class="number">1</span>;</span><br><span class="line">        ad[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||x&gt;r) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">        ad[rt]=k+<span class="number">1</span>;</span><br><span class="line">        sum[rt]=k*(r-l+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) update(rt&lt;&lt;<span class="number">1</span>,l,m,x,y,k);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y,k);</span><br><span class="line">    pushup(rt);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> rt,<span class="keyword">int</span> l,<span class="keyword">int</span> r,<span class="keyword">int</span> x,<span class="keyword">int</span> y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (l&gt;y||x&gt;r) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y) <span class="keyword">return</span> sum[rt];</span><br><span class="line">    pushdown(rt,l,r);</span><br><span class="line">    <span class="keyword">int</span> m=(l+r)&gt;&gt;<span class="number">1</span>,ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (m&gt;=x) ret+=query(rt&lt;&lt;<span class="number">1</span>,l,m,x,y);</span><br><span class="line">    <span class="keyword">if</span> (m&lt;y) ret+=query(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,m+<span class="number">1</span>,r,x,y);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ef</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> y,<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> l=<span class="number">0</span>,r=y-x,mid;</span><br><span class="line">    <span class="keyword">if</span> (x&gt;y) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l&lt;=r)&#123;</span><br><span class="line">        mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (query(<span class="number">1</span>,<span class="number">1</span>,n,x,x+mid)==k*(mid+<span class="number">1</span>)) l=mid+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> x,y,b,c,d;</span><br><span class="line">    read(n); read(t);</span><br><span class="line">    build(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">    <span class="keyword">while</span> (t--)&#123;</span><br><span class="line">        read(b),read(x),read(y);</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">0</span>)&#123;</span><br><span class="line">            update(<span class="number">1</span>,<span class="number">1</span>,n,x,y,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">1</span>)&#123;</span><br><span class="line">            read(c),read(d);</span><br><span class="line">            <span class="keyword">int</span> num=query(<span class="number">1</span>,<span class="number">1</span>,n,x,y),p=<span class="number">0</span>;</span><br><span class="line">            update(<span class="number">1</span>,<span class="number">1</span>,n,x,y,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (num&gt;=(d-c+<span class="number">1</span>)-query(<span class="number">1</span>,<span class="number">1</span>,n,c,d))&#123;</span><br><span class="line">                update(<span class="number">1</span>,<span class="number">1</span>,n,c,d,<span class="number">1</span>); <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (num==<span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (query(<span class="number">1</span>,<span class="number">1</span>,n,c,c)==<span class="number">1</span>)&#123;</span><br><span class="line">                    p=ef(c,d,<span class="number">1</span>); c+=p; </span><br><span class="line">                &#125;</span><br><span class="line">                p=ef(c,d,<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (p==<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">if</span> (p&gt;num)&#123;</span><br><span class="line">                    update(<span class="number">1</span>,<span class="number">1</span>,n,c,c+num<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    update(<span class="number">1</span>,<span class="number">1</span>,n,c,c+p<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">                    num-=p; c+=p;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (b==<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">int</span> ans=<span class="number">0</span>,p=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (query(<span class="number">1</span>,<span class="number">1</span>,n,x,x)==<span class="number">1</span>)&#123;</span><br><span class="line">                    p=ef(x,y,<span class="number">1</span>); x+=p;</span><br><span class="line">                &#125;</span><br><span class="line">                p=ef(x,y,<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">if</span> (p==<span class="number">-1</span>) <span class="keyword">break</span>;</span><br><span class="line">                ans=max(ans,p);</span><br><span class="line">                x+=p; <span class="keyword">if</span> (x&gt;y) <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            write(ans); <span class="built_in">puts</span>(<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="洛谷P1712-NOI2016-区间"><a href="#洛谷P1712-NOI2016-区间" class="headerlink" title="洛谷P1712 [NOI2016]区间"></a><strong>洛谷P1712 [NOI2016]区间</strong></h3><p><strong>题目描述</strong></p>
<p>在数轴上有 N 个闭区间 [l1,r1],[l2,r2],…,[ln,rn] 。现在要从中选出 M 个区间，使得这 M 个区间共同包含至少一个位置。换句话说，就是使得存在一个 x ，使得对于每一个被选中的区间 [li,ri] ，都有 li≤x≤ri 。</p>
<p>对于一个合法的选取方案，它的花费为被选中的最长区间长度减去被选中的最短区间长度。区间 [li,ri] 的长度定义为 ri−li ，即等于它的右端点的值减去左端点的值。</p>
<p>求所有合法方案中最小的花费。如果不存在合法的方案，输出 −1 。</p>
<p><strong>输入输出格式</strong></p>
<p><strong>输入格式：</strong> </p>
<p>第一行包含两个正整数 N,M 用空格隔开，意义如上文所述。保证 1≤M≤N</p>
<p>接下来 N 行，每行表示一个区间，包含用空格隔开的两个整数 li 和 ri 为该区间的左右端点。 </p>
<p>N&lt;=500000,M&lt;=200000,0≤li≤ri≤109</p>
<p> <strong>输出格式：</strong></p>
<p>只有一行，包含一个正整数，即最小花费。 </p>
<p>首先我们肯定知道，如果要添加一个区间的话肯定是区间加的，那我一开始的想法就是找到被覆盖m次以上的点，同时在覆盖的时候记下每个点所在的最大和最小的区间。</p>
<p>然而这个算法很难实现，每个点在的最大和最小的区间难以用线段树维护。</p>
<p>那我们换一个做法，枚举能构成答案的区间，，这是个N2的步骤，为了方便计算答案，我们先对区间按长度排个序，这样我们就有一个N2 log N的算法。</p>
<p>接下来考虑优化，想一下前面那个算法有什么浪费的地方？</p>
<p>假设我们在从第i个区间选起，一直选了j个区间，此时符合要求了，我们选完收工，线段树清零。</p>
<p>到了第i+1个区间，好像也至少要选到第j个区间，这么一看，我们只要把第i个区间删了就好了。（有点像滑动窗口？）</p>
<p>这样大概就完了吗，还有几个小问题。</p>
<p>Q：怎么判断是否有点被覆盖了m次？</p>
<p>A：这个可以维护一个最大值，这样只要看根节点就好了，都不用写查询函数。</p>
<p>Q：为什么你没有说离散化和去重？</p>
<p>A：这。。。有人会忘吗？</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> re register</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ONLINE_JUDGE</span></span><br><span class="line"><span class="keyword">char</span> ss[<span class="number">1</span>&lt;&lt;<span class="number">17</span>],*A=ss,*B=ss;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">char</span> <span class="title">gc</span><span class="params">()</span></span>&#123;<span class="keyword">if</span>(A==B)&#123;B=(A=ss)+fread(ss,<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">17</span>,<span class="built_in">stdin</span>);<span class="keyword">if</span>(A==B)<span class="keyword">return</span> EOF;&#125;<span class="keyword">return</span>*A++;&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;<span class="title">inline</span> <span class="title">void</span> <span class="title">read</span>(<span class="title">T</span>&amp;<span class="title">x</span>)&#123;</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> c;<span class="keyword">static</span> <span class="keyword">int</span> y;</span><br><span class="line">    <span class="keyword">for</span>(c=gc(),x=<span class="number">0</span>,y=<span class="number">1</span>;c&lt;<span class="number">48</span>||<span class="number">57</span>&lt;c;c=gc())<span class="keyword">if</span>(c==<span class="string">'-'</span>)y=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(;<span class="number">48</span>&lt;=c&amp;&amp;c&lt;=<span class="number">57</span>;c=gc())x=((x+(x&lt;&lt;<span class="number">2</span>))&lt;&lt;<span class="number">1</span>)+(c^<span class="string">'0'</span>);</span><br><span class="line">    x*=y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(ll&amp;x)</span></span>&#123;<span class="built_in">scanf</span>(<span class="string">"%lld"</span>,&amp;x);&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">    ll l,r,z;</span><br><span class="line">&#125;qg[<span class="number">500001</span>];</span><br><span class="line">ll a[<span class="number">1500010</span>],sum[<span class="number">4000010</span>],ad[<span class="number">4000010</span>];</span><br><span class="line">ll n,m,tail,head,ans,size,minn,maxn;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(node c,node d)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> c.z&lt;d.z;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(ll rt)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ad[rt])&#123;</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>]+=ad[rt];</span><br><span class="line">        sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=ad[rt];</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>]+=ad[rt];</span><br><span class="line">        ad[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=ad[rt];</span><br><span class="line">        ad[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(ll rt,ll l,ll r,ll x,ll y,ll k)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x&gt;r||l&gt;y) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (x&lt;=l&amp;&amp;r&lt;=y)&#123;</span><br><span class="line">        ad[rt]+=k;</span><br><span class="line">        sum[rt]+=k;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    pushdown(rt);</span><br><span class="line">    ll mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    update(rt&lt;&lt;<span class="number">1</span>,l,mid,x,y,k);</span><br><span class="line">    update(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,x,y,k);</span><br><span class="line">    sum[rt]=max(sum[rt&lt;&lt;<span class="number">1</span>],sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ll x,y;</span><br><span class="line">    read(n); read(m);</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        read(x); read(y);</span><br><span class="line">        a[i*<span class="number">2</span>]=x; a[i*<span class="number">2</span>+<span class="number">1</span>]=y;</span><br><span class="line">        qg[i].l=x; qg[i].r=y; qg[i].z=y-x;</span><br><span class="line">    &#125;</span><br><span class="line">    sort(a+<span class="number">1</span>,a+n*<span class="number">2</span>+<span class="number">2</span>);</span><br><span class="line">    size=unique(a+<span class="number">1</span>,a+n*<span class="number">2</span>+<span class="number">1</span>)-(a+<span class="number">1</span>);</span><br><span class="line">    sort(qg+<span class="number">1</span>,qg+n+<span class="number">1</span>,cmp);</span><br><span class="line">    <span class="keyword">for</span> (re <span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">        qg[i].l=lower_bound(a+<span class="number">1</span>,a+size+<span class="number">1</span>,qg[i].l)-a;</span><br><span class="line">        qg[i].r=lower_bound(a+<span class="number">1</span>,a+size+<span class="number">1</span>,qg[i].r)-a;</span><br><span class="line">        minn=min(minn,qg[i].l); maxn=max(maxn,qg[i].r);</span><br><span class="line">    &#125;</span><br><span class="line">    head=<span class="number">0</span>; tail=<span class="number">0</span>;</span><br><span class="line">    ans=<span class="number">1e9</span>;</span><br><span class="line">    <span class="keyword">while</span> (tail&lt;n)&#123;</span><br><span class="line">        <span class="keyword">while</span> (sum[<span class="number">1</span>]&lt;m&amp;&amp;tail&lt;=n)&#123;</span><br><span class="line">        tail++; update(<span class="number">1</span>,minn,maxn,qg[tail].l,qg[tail].r,<span class="number">1</span>);&#125;</span><br><span class="line">        <span class="keyword">if</span> (sum[<span class="number">1</span>]&lt;m) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">while</span> (sum[<span class="number">1</span>]&gt;=m&amp;&amp;tail&gt;=head)&#123;</span><br><span class="line">        head++; update(<span class="number">1</span>,minn,maxn,qg[head].l,qg[head].r,<span class="number">-1</span>);&#125;</span><br><span class="line">        ans=min(ans,qg[tail].z-qg[head].z);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ans==<span class="number">1e9</span>) ans=<span class="number">-1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%lld"</span>,ans);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/12/11/线段树练习（也有树状数组）/">线段树练习（也有树状数组）</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 Taduro 的个人博客">Taduro</a></p>
        <p><span>发布时间:</span>2018年12月11日 - 12时40分</p>
        <p><span>最后更新:</span>2018年12月11日 - 18时19分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/12/11/线段树练习（也有树状数组）/" title="线段树练习（也有树状数组）">http://dftyem.github.io/2018/12/11/线段树练习（也有树状数组）/</a>
            <span class="copy-path" data-clipboard-text="原文: http://dftyem.github.io/2018/12/11/线段树练习（也有树状数组）/　　作者: Taduro" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target="_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2018/12/11/洛谷P4231-三步必杀/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          洛谷P4231 三步必杀
        
      </div>
    </a>
  
  
    <a href="/2018/12/11/洛谷-P3740-HAOI2014-贴海报/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">洛谷 P3740 [HAOI2014]贴海报</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#线段树练习（也有树状数组）"><span class="toc-number">1.</span> <span class="toc-text">线段树练习（也有树状数组）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷-P2184-贪婪大陆"><span class="toc-number">1.1.</span> <span class="toc-text">洛谷 P2184 贪婪大陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷-P3870-TJOI2009-开关-P2846-USACO08NOV-光开关Light-Switching-P2574-XOR的艺术（三道重题）"><span class="toc-number">1.2.</span> <span class="toc-text">洛谷 P3870 [TJOI2009]开关+P2846 [USACO08NOV]光开关Light Switching+P2574 XOR的艺术（三道重题）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷-P1471-方差"><span class="toc-number">1.3.</span> <span class="toc-text">洛谷 P1471 方差</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷-P1438-无聊的数列"><span class="toc-number">1.4.</span> <span class="toc-text">洛谷 P1438 无聊的数列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷-P1558-色板游戏"><span class="toc-number">1.5.</span> <span class="toc-text">洛谷 P1558 色板游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷-P1637-三元上升子序列"><span class="toc-number">1.6.</span> <span class="toc-text">洛谷 P1637 三元上升子序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷-P4145-上帝造题的七分钟2-花神游历各国"><span class="toc-number">1.7.</span> <span class="toc-text">洛谷 P4145 上帝造题的七分钟2 / 花神游历各国</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷-P4344-SHOI2015-脑洞治疗仪"><span class="toc-number">1.8.</span> <span class="toc-text">洛谷 P4344 [SHOI2015]脑洞治疗仪</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#洛谷P1712-NOI2016-区间"><span class="toc-number">1.9.</span> <span class="toc-text">洛谷P1712 [NOI2016]区间</span></a></li></ol></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">

<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>





<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    
        <div id="gitments"></div>
<script src="/js/gitment.browser.js"></script>
<script>
    var gitment = new Gitment({
      id: window.location.pathname,
      owner: 'dftyem',
      repo: 'https://github.com/dftyem/hello-world',
      oauth: {
        client_id: '72e69a37eb8cbe74dccc',
        client_secret: 'da0dfd535252b3a2dcf178da61e0a31d624a3cc8',
      },
    })
    gitment.render('gitments')
</script>
    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/12/11/洛谷P4231-三步必杀/" title="上一篇: 洛谷P4231 三步必杀">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2018/12/11/洛谷-P3740-HAOI2014-贴海报/" title="下一篇: 洛谷 P3740 [HAOI2014]贴海报">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/02/14/AC自动机学习笔记/">AC自动机学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/13/CF842D-Vitya-and-Strange-Lesson/">CF842D Vitya and Strange Lesson</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/12/HNOI2016-大数/">[HNOI2016]大数</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/12/JSOI2009-等差数列/">[JSOI2009]等差数列</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/12/hello-world/">Hello World</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/15/平衡树被虐笔记/">平衡树被虐笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/08/作诗/">作诗</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/07/HEOI2012-采花/">[HEOI2012]采花</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/06/Count-on-a-tree/">Count on a tree</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/04/方格取数问题/">方格取数问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/01/SP4060-KPGAME-A-game-with-probability/">SP4060 KPGAME-A game with probability</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/29/CQOI2018-异或序列/">[CQOI2018]异或序列</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/27/莫队学习笔记/">莫队学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/25/POI2013-USU-Take-out-题解/">[POI2013]USU-Take-out 题解</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/23/SHOI2010-最小生成树/">[SHOI2010]最小生成树</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/NOIP2018游记/">NOIP2018游记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/2-SAT学习笔记/">2-SAT学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/洛谷P4231-三步必杀/">洛谷P4231 三步必杀</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/线段树练习（也有树状数组）/">线段树练习（也有树状数组）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/洛谷-P3740-HAOI2014-贴海报/">洛谷 P3740 [HAOI2014]贴海报</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/洛谷-P2205-USACO13JAN-画栅栏/">洛谷 P2205 [USACO13JAN]画栅栏</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/单调队列练习/">单调队列练习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/洛谷-P1736-创意吃鱼法（多维DP）/">洛谷 P1736 创意吃鱼法（多维DP）</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/12/11/电脑班的裁员（区间DP）/">电脑班的裁员（区间DP）</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2019 Taduro
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/luuman/hexo-theme-spfk" target="_blank">spfk</a> by luuman
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit">大佬到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


  </div>
</body>
</html>